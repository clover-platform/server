<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="plus.xyc.server.i18n.entry.mapper.EntryStateMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="plus.xyc.server.i18n.entry.entity.dto.EntryState">
        <id column="id" property="id" />
        <result column="entry_id" property="entryId" />
        <result column="language" property="language" />
        <result column="translated" property="translated" />
        <result column="result_id" property="resultId" />
        <result column="verified" property="verified" />
        <result column="translation_time" property="translationTime" />
        <result column="verification_time" property="verificationTime" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, entry_id, language, translated, result_id, verified, translation_time, verification_time
    </sql>

    <select id="countTranslated" resultType="long">
        select
        count(1) as total
        from entry as e
        left join branch as b on e.branch_id = b.id
        where
        e.deleted = false and b.deleted = false and e.translated = true
        <if test="request.branch != null">
            and b.name = #{request.branch}
        </if>
        <if test="request.moduleId != null">
            and e.module_id = #{request.moduleId,jdbcType=NUMERIC}
        </if>
    </select>

    <select id="countVerified" resultType="long">
        select
        count(1) as total
        from entry as e
        left join branch as b on e.branch_id = b.id
        where
        e.deleted = false and b.deleted = false and e.verified = true
        <if test="request.branch != null">
            and b.name = #{request.branch}
        </if>
        <if test="request.moduleId != null">
            and e.module_id = #{request.moduleId,jdbcType=NUMERIC}
        </if>
    </select>

</mapper>
